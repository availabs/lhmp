with criticalMeta(key, name) as (
    values
        ('70100', 'Agriculture or Livestock Structure'),
        ('70101', 'Agriculture Experimental Station'),
        ('70102', 'Food Industry Facility'),
        ('70103', 'Bakery (Regional)'),
        ('70104', 'Beverage Bottling Plant'),
        ('70106', 'Brewery / Distillery / Winery'),
        ('70108', 'Cannery'),
        ('70110', 'Corral'),
        ('70112', 'Dairy'),
        ('70114', 'Farm / Ranch'),
        ('70116', 'Feedlot'),
        ('70118', 'Food Distribution Center'),
        ('70120', 'Fish Farm / Hatchery'),
        ('70121', 'Fish Ladder'),
        ('70122', 'Grain Elevator'),
        ('70124', 'Grain Mill'),
        ('70126', 'Greenhouse / Nursery'),
        ('70128', 'Livestock Complex'),
        ('70132', 'Meat Processing / Pkg Facility'),
        ('70134', 'Stockyard / Feedlot'),
        ('70136', 'Veternary Hospital / Clinic'),
        ('71000', 'Industrial Facility'),
        ('71001', 'Chemical Facility'),
        ('71002', 'Manufacturing Facility'),
        ('71004', 'Aircraft Manufacturing Facility'),
        ('71006', 'Armament Manufacturing Facility'),
        ('71008', 'Automotive Mftg Facility'),
        ('71010', 'Durable / Non-Durable Goods'),
        ('71012', 'Explosives Facility'),
        ('71014', 'Fertilizer Facility'),
        ('71016', 'Hazardous Materials Facility'),
        ('71018', 'Hazardous Waste Facility'),
        ('71020', 'Household Products Facility'),
        ('71022', 'Landfill'),
        ('71024', 'Lumber Mill / Saw Mill'),
        ('71026', 'Maintenance Yard'),
        ('71028', 'Manufacturing Warehouse'),
        ('71030', 'Mine'),
        ('71032', 'Mine Waste Disposal Site'),
        ('71034', 'Mine Uranium Facility'),
        ('71036', 'Nuclear Weapons Facility'),
        ('71038', 'Ore Processing Facility'),
        ('71040', 'Paper / Pulp Mill'),
        ('71042', 'Pharmaceutical Plant'),
        ('71044', 'Semiconductor & Microchip Flty'),
        ('71046', 'Shipyard'),
        ('71048', 'Steel Plant'),
        ('71050', 'Superfund Site'),
        ('71052', 'Textile Plant'),
        ('72000', 'Commercial or Retail Facility'),
        ('72002', 'Corporate Headquarters'),
        ('72004', 'Gas Station'),
        ('72006', 'Grocery Store'),
        ('72008', 'Hotel / Motel'),
        ('72010', 'Shopping Mall / Complex'),
        ('72012', 'Warehouse (Retail / Wholesale)'),
        ('73000', 'Education Facility'),
        ('73002', 'School'),
        ('73004', 'College / University'),
        ('74000', 'Emergency Response / Law Enfmt Flty'),
        ('74001', 'Ambulence Service'),
        ('74002', 'American Red Cross Facility'),
        ('74004', 'Forder Patrol'),
        ('74006', 'Bur.of Alchohol, Tobacco, and Firearms'),
        ('74008', 'Civil Defense'),
        ('74010', 'Coast Guard'),
        ('74012', 'Customs Service'),
        ('74014', 'Department of Justice'),
        ('74016', 'Drug Enforcement Agency'),
        ('74018', 'Federal Bureau of Investigation'),
        ('74020', 'Federal Emergency Mgmt Agency'),
        ('74022', 'Fire Equipment Manufacturer'),
        ('74024', 'Fire Hydrant'),
        ('74026', 'Fire Station / EMS Station'),
        ('74028', 'Fire Training Facility / Academy'),
        ('74030', 'Immigration and Naturalization Service'),
        ('74032', 'Marshal Service'),
        ('74034', 'Law Enforcement'),
        ('74036', 'Prison / Correctional Facility'),
        ('74038', 'Search and Rescue Office'),
        ('74040', 'Secret Service'),
        ('74042', 'Transportation Safety Board'),
        ('74044', 'Office of Emergency Management'),
        ('75000', 'Energy Facility'),
        ('75002', 'Energy Distribution Control Flty'),
        ('75004', 'Natural Gas Facility'),
        ('75006', 'Nuclear Fuel Plant'),
        ('75008', 'Nuclear Research Facility'),
        ('75009', 'Nuclear Waste Processing / Strg Flty'),
        ('75010', 'Nuclear Weapons Plant'),
        ('75012', 'Oil / Gas Facility'),
        ('75014', 'Oil / Gas Well of Field'),
        ('75016', 'Oil / Gas Extract. or Injection Well'),
        ('75018', 'Oil / Gas Pumping Station'),
        ('75020', 'Oil / Gas Refinery'),
        ('75022', 'Oil / Gas Processing Plant'),
        ('75024', 'Oil / Gas Storage Flty / Tank Farm'),
        ('75026', 'POL Storage Tank'),
        ('75028', 'Strategic Petroleum Reserve'),
        ('75030', 'Electric Facility'),
        ('75032', 'Hydroelectric Facility'),
        ('75034', 'Nuclear Facility'),
        ('75036', 'Solar Facility'),
        ('75038', 'Substation'),
        ('75039', 'Coal Facility'),
        ('75040', 'Wind Facility'),
        ('75041', 'Waste / Biomass Facility'),
        ('75042', 'Tidal Facility'),
        ('75043', 'Geothermal Facility'),
        ('76000', 'Banking or Finance Facility'),
        ('76004', 'Bank'),
        ('76006', 'Bullion Repository'),
        ('76008', 'Check Clearing Center'),
        ('76010', 'Commodities Exchange'),
        ('76012', 'Federal Reserve Bank / Branch'),
        ('76014', 'Financial Processing Center'),
        ('76016', 'Financial Services Company'),
        ('76018', 'Investment / Brokerage Center'),
        ('76020', 'Insurance and Finance Center'),
        ('76022', 'Stock Exchange'),
        ('76024', 'U.S. Mint / Bur. of Engraving & Pringing'),
        ('78000', 'Mail or Shipping Facility'),
        ('78002', 'Air Shipping Hub'),
        ('78004', 'Bulk Mail Center'),
        ('78006', 'Post Office'),
        ('78008', 'Pvte and Express Shipping Flty'),
        ('79000', 'Building General'),
        ('79002', 'Mobile Home Park'),
        ('79004', 'Multi-Family Dwelling'),
        ('79006', 'Single-Family Dwelling'),
        ('79008', 'Institutional Residence / Dorm / Barracks'),
        ('80000', 'Health or Medical Facility'),
        ('80002', 'Blood Bank'),
        ('80004', 'Center for Disease Control Office'),
        ('80006', 'Day Care Facility'),
        ('80008', 'Diagnostic Laboratory'),
        ('80010', 'Homeless Shelter'),
        ('80012', 'Hospital / Medical Center'),
        ('80014', 'Medical Research laboratory'),
        ('80016', 'Medical Stockpile Facility'),
        ('80018', 'Morgue'),
        ('80020', 'Mortuary / Crematory'),
        ('80022', 'Nursing Home / Long Term Care'),
        ('80024', 'Outpatient Clinic'),
        ('80026', 'Pharmacy'),
        ('80028', 'Public Health Office'),
        ('80030', 'Rehabilitation Center'),
        ('81000', 'Transportation Facility'),
        ('81006', 'AIrport Terminal'),
        ('81008', 'AIr Support/Maintence Facility'),
        ('81010', 'Air Traffice Control Center/COmmand Center'),
        ('81011', 'Boat Ramp/Dock'),
        ('81012', 'Bridge'),
        ('81014', 'Bridge: Light Rail/Subway'),
        ('81016', 'Bridge:Railroad'),
        ('81018', 'Bridge:Road'),
        ('81020', 'Border Crossing/Port of Entry'),
        ('81022', 'Bus Station /Dispatch FacilityIndustrial Facility'),
        ('81024', 'Ferry Terminal/Dispatch Facility'),
        ('81025', 'Harbor/Marina'),
        ('81026', 'Hellpad/Heliport/Helispot'),
        ('81028', 'Launch Facility'),
        ('81030', 'Launch Pad'),
        ('81032', 'Light Rail Power Substation'),
        ('81034', 'Light Rail Station'),
        ('81036', 'Park and Ride /Commuter Lot'),
        ('81038', 'Parking Lot Structure/Garage'),
        ('81040', 'Pier/Wharf/Quay/Mole'),
        ('81042', 'Port Facility'),
        ('81044', 'Port Facility:Commercial Port'),
        ('81046', 'Port Facility:Crane'),
        ('81048', 'Port Facility:Maintenance and Fuel Facility'),
        ('81050', 'Port Facility:Modal Transfter Facility'),
        ('81052', 'Port Facility:Passenger Terminal'),
        ('81054', 'Port Facility:Warehouse Storage/Container Yd'),
        ('81056', 'Railroad Facility'),
        ('81058', 'RailroadCommand/Control Facility'),
        ('81060', 'Railroad Freight Loading Facility'),
        ('81062', 'Railroad Maintence /Fuel Facility'),
        ('81064', 'railroad Roundhouse/Turntable'),
        ('81066', 'Railroad Station'),
        ('81068', 'Railroad yard'),
        ('81070', 'Rest Stop/Roadside Park'),
        ('81072', 'Seaplane Anchorage /Base'),
        ('81073', 'Snowshed'),
        ('81074', 'Subway Station'),
        ('81076', 'Toll Booth/Plaza'),
        ('81078', 'Truck Stop'),
        ('81080', 'Tunnel'),
        ('81082', 'Tunnel: Light Rail/Subway'),
        ('81084', 'Tunnel:Road'),
        ('81086', 'Tunnel:Railroad'),
        ('81088', 'Weigh Station /Inspection Station'),
        ('82000', 'Public Attraction/Landmark Bldg'),
        ('82002', 'Amusement / Water Park'),
        ('82004', 'Arboretem / Botanical Garden'),
        ('82006', 'Auditorium/Theater'),
        ('82008', 'Campground'),
        ('82010', 'Cemetary'),
        ('82011', 'Community / Recreation Center'),
        ('82012', 'Convention Center'),
        ('82014', 'Fair / Exhibition / Rodeo Grounds'),
        ('82016', 'Gold Course'),
        ('82018', 'Historic Site / Point of Interest'),
        ('82020', 'Houe of Worship'),
        ('82022', 'Ice Arena'),
        ('82024', 'Library'),
        ('82026', 'Lighthouse / Light'),
        ('82028', 'Lockout Tower'),
        ('82030', 'Marina'),
        ('82032', 'Museum'),
        ('82034', 'National Symbol / Monument'),
        ('82036', 'Observatory'),
        ('82038', 'Outdoor Theater / Amphitheater'),
        ('82040', 'Picnic Area'),
        ('82042', 'Racetrack / Dragstrip'),
        ('82044', 'Ski Area / Ski Resort'),
        ('82046', 'Sports Arena / Stadium'),
        ('82047', 'Trailhead'),
        ('82048', 'Visitor / Information Center'),
        ('82050', 'Zoo'),
        ('83000', 'Government of Military Facility'),
        ('83002', 'Bureau of Land Mgmt Facility'),
        ('83004', 'US Capitol'),
        ('83006', 'State Capitol'),
        ('83008', 'US Supreme Court'),
        ('83010', 'State Supreme Court'),
        ('83011', 'Court House'),
        ('83012', 'Critical Federal Contractor Flty'),
        ('83014', 'Department of Energy Facility'),
        ('83016', 'Department of State Facility'),
        ('83018', 'Dept of Motor Vehicle Facility'),
        ('83020', 'DoD / Military Facility'),
        ('83022', 'Governor Residence'),
        ('83024', 'Intelligence Facility'),
        ('83026', 'Local Government Facility'),
        ('83028', 'NASA Facility'),
        ('83030', 'National Guard Armory / Base'),
        ('83032', 'National Park Service Facility'),
        ('83034', 'State Government Facility'),
        ('83036', 'Tribal Government Facility'),
        ('83038', 'US Forest Service Facility'),
        ('83040', 'Us Government Facility'),
        ('83042', 'White House'),
        ('83043', 'Department of Public Works'),
        ('83044', 'City / Town Hall'),
        ('84000', 'Weather Facility or Structure'),
        ('84002', 'Warning Center'),
        ('84004', 'Weather Data Center'),
        ('84006', 'Weather Forecast Office'),
        ('84008', 'Weather Radar Site'),
        ('85000', 'Water Supply or Teratment Facility'),
        ('85001', 'Portable Water Facility'),
        ('85002', 'Public Water Supply Intake'),
        ('85004', 'Public Water Supply Well'),
        ('85006', 'Wastewater Treatment Plant'),
        ('85008', 'Water Pumping Station'),
        ('85010', 'Water System Control Facility'),
        ('85012', 'Water Tank'),
        ('85014', 'Water Tower'),
        ('85016', 'Water Treatment Facility'),
        ('88000', 'Information/Communication Flty'),
        ('88002', 'Communication Tower'),
        ('88004', 'Data Center'),
        ('88006', 'Internet DNS Location'),
        ('88008', 'Internet Metro Area Exchge / Hub'),
        ('88010', 'Internet Service Provider'),
        ('88012', 'Radio / TV Broadcast Facility'),
        ('88014', 'Satellite Ground Station'),
        ('88016', 'Telephone Facility')
), buildings as (SELECT
                     ebr.building_id, replacement_value,

                     -- critical meta
                     critical, criticalMeta.name critical_name,

                     -- prop class meta
                     prop_class, parcel_meta.name parcel_class_name,

                     -- shelter meta
                     shelter, shelter_name,
                     facility_usage_code,
                     evacuation_capacity,
                     post_impact_capacity,
                     ada_compliant,
                     wheelchair_accessible,
                     pet_accomodations,
                     generator_onsite,
                     self_suffienct_electricty,
                     shelter_code
                         ,flood_depth, flood_velocity, flood_base_elevation, value_source, flood_zone, foundation_type, structure_type, roof_type, building_type, num_stories, basement, num_units,
                     address, num_residents, num_employees, num_occupants, num_vehicles_inhabitants, height, bldg_style, sqft_living, nbr_kitchens, nbr_full_baths, nbr_bedrooms, first_floor_elevation, heat_type, naics_code, census_industry_code,
                     contents_replacement_value, inventory_replacement_value, establishment_revenue, business_hours, seismic_zone, flood_plain, flood_duration, high_wind_speed, soil_type, storage_hazardous_materials, topography, sewer_type, fuel_type,
                     water_supply,

                     -- cousub meta
                     cousub_geoid, cousub.namelsad cousub_name,
                     tract_geoid, dup_geoid,

                     -- county meta
                     ebr.geoid, county.namelsad,

                     establishments, owner_type, parcel_id, ebr.name, type, place_geoid, user_property_class, emergency_generator, agency, ebrg.footprint
                 FROM irvs.enhanced_building_risk ebr
                          join (select building_id, footprint from irvs.enhanced_building_risk_geom) ebrg
                               on ebr.building_id = ebrg.building_id
                          left join  irvs.shelters shelters
                                     on ebr.shelter = shelters.shelter_id
                          left join criticalMeta
                                    on critical = criticalMeta.key
                          left join parcel.parcel_meta
                                    on prop_class = parcel_meta.value
                          left join geo.tl_2017_cousub cousub
                                    on cousub_geoid = cousub.geoid
                          left join geo.tl_2017_us_county county
                                    on substring(ebr.geoid, 1, 5) = county.geoid
                 where substring(ebr.geoid, 1, 5) = '36001'
)

select * from buildings
